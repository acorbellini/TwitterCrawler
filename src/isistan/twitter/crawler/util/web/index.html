<!doctype html>
<html>
<head>
<title>TwitterStore Terminal</title>
<link rel="stylesheet" type="text/css" href="terminal.css" />
<link rel="stylesheet" type="text/css" href="jquery.terminal.css" />
<link rel="stylesheet" type="text/css" href="jquery.dataTables.min.css" />
</head>
<body>
	<div id="terminal"></div>
</body>
<script type="text/javascript" src="jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="jquery.mousewheel.min.js"></script>
<script type="text/javascript" src="jquery.terminal-0.8.8.min.js"></script>
<script type="text/javascript" src="jquery.dataTables.min.js"></script>
<script type="text/javascript">
    jQuery(function($, undefined) {
	$('#terminal')
		.terminal(
			function(command, term) {
			    if (command !== '') {
				term.pause();
				$
					.get(
						"/api/" + encodeURI(command),
						function(result) {
						    try {
							var asJson = JSON
								.parse(result);
							var list = asJson["table"];
						    } catch (e) {

						    }
						    if (list != undefined) {
							if (list.length == 0)
							    term
								    .echo("No Records");
							else {
							    var first = true;
							    var table = "<table class=\"compact\" >";
							    for ( var index in list) {

								var obj = list[index];
								if (first) {
								    first = false;
								    table += "<thead> <tr>"
								    for ( var prop in obj)
									table += "<td>"
										+ prop
										+ "</td>";
								    table += "</tr></thead>"
								}
								table += "<tr>";
								for ( var prop in obj)
								    if (obj
									    .hasOwnProperty(prop))
									table += "<td>"
										+ obj[prop]
										+ "</td>"
								table += "</tr>";
							    }
							    table += "</table>";
							    term
								    .echo(
									    table,
									    {
										raw : true,
										finalize : function(
											div) {
										    div
											    .css(
												    "background-color",
												    "#969696");
										    div
											    .css(
												    "color",
												    "#000");
										    div
											    .find(
												    "table")
											    .DataTable(
												    {
													autoWidth:true,
													scrollY : 250,
													scrollX : 100,
													searching : false
												    });
										}
									    });
							}
						    } else
							term.echo(new String(
								result));
						    term.resume();
						    $(document).scrollTop($(document).height())
						})
					.fail(
						function(error) {
						    term
							    .error(error.responseText);
						    term.resume();	
						    $(document).scrollTop($(document).height())

						});
			    } else {
				term.echo('');
			    }
			},
			{
			    greetings : 'TwitterStore\n Examples: store.getTweets(UID, TweetType.TWEETS/FAVORITES)'
				    + '\n store.getAdjacency(UID, ListType.FOLLOWEES/FOLLOWEERS)',
			    name : 'TwitterStore Terminal',
			    prompt : 'js> ',
			    height : "100%"
			});
    });

    /*  $(window).resize(function() {
    $('#terminal').height($(window).height() - 46);
     });

     $(window).trigger('resize'); */
</script>
</html>